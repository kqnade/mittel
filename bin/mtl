#!/usr/bin/env bash

# --------- Variables & Settings ---------

# mtl directory
MTL_DIR="$HOME/.mtl"

# mtl lib directory
MTL_LIB_DIR="$MTL_DIR/lib"

# mtl bin directory
MTL_BIN_DIR="$MTL_DIR/bin"

# mtl pakcages directory
MTL_PACKAGES_DIR="$MTL_DIR/pkgs"

# mtl command directory
MTL_CMD_DIR="$MTL_LIB_DIR/cmd"

# mtl utils directory
MTL_UTILS_DIR="$MTL_LIB_DIR/utils"

# mtl config file
MTL_CONF_FILE="$HOME/.mtlrc"

# mtl version
MTL_VERSION="0.0.1"


# --------- Config ---------

# --------- Set Up ---------
# exist mtl directory git clone
if [[ ! -d "$MTL_DIR" ]]; then
  # git clone
  git clone https://github.com/kqnade/mtl.git $MTL_DIR
  echo "Mittel Clone Success!"
fi

# Directory Check
if [[ ! -d "$MTL_PACKAGES_DIR" ]]; then
  echo "Mittel Error: $MTL_PACKAGES_DIR not found"
  mkdir $MTL_PACKAGES_DIR
  echo "Mittel Create: $MTL_PACKAGES_DIR"
fi

# config loader
source $MTL_UTILS_DIR/conf.sh

# load config
load_config $MTL_CONF_FILE

# --------- Commands ---------

# commands loader
source $MTL_UTILS_DIR/cmd.sh

# load commands
load_commands


# --------- Utils ---------

# utils loader
source $MTL_UTILS_DIR/utils.sh

# load utils
load_utils

# --------- Main ---------

main() {
  # if $1 arg has - or --
  if [[ "$1" == "-"* || "$1" == "--"* ]]; then
    # -v or --version
    if [[ "$1" == "-v" || "$1" == "--version" ]]; then
      echo "mtl version $MTL_VERSION"
      exit 0
    fi
    # -h or --help
    if [[ "$1" == "-h" || "$1" == "--help" ]]; then
      # shift 1 arg
      shift 1
      # run help
      help "$@"
      exit 0
    fi
  fi
  # run command
  run_command "$@"
  # exit
  exit 0
}

# --------- Run ---------

# run main
main "$@"